FROM ubuntu:14.04

ENV DEBIAN_FRONTEND noninteractive

RUN locale-gen en_US.UTF-8 && dpkg-reconfigure locales
ENV LANG en_US.UTF-8

RUN apt-get update -qq && apt-get upgrade -y -qq install wget

RUN useradd --create-home --shell /bin/bash reddit
RUN usermod -aG sudo reddit
WORKDIR /home/reddit

# TODO - change 'docker' back to 'master'
RUN wget https://raw.github.com/libertysoft3/saidit/docker/install-reddit.sh
RUN chmod +x install-reddit.sh
RUN yes | REDDIT_DOMAIN=reddit.local REDDIT_USER=reddit REDDIT_HOME=/home/reddit INSTALL_PROFILE=docker ./install-reddit.sh

# startup/init script - FAIL
COPY docker/reddit/init-cassandra.sh /docker-entrypoint-initdb.d/init-cassandra.sh

EXPOSE 8001

# keep this container running without a foreground task
# parent image has: CMD ["/bin/bash"]
CMD ["tail", "-f", "/dev/null"]